# Task 3.2: Implement Encrypted Persistent Storage for Client Credentials

Implement a persistent, encrypted store for client credentials using RocksDB and AES-256-GCM.

## Status
- **Status:** Completed
- **Assignee:** Gemini CLI
- **Created:** 2026-02-20
- **Last Updated:** 2026-02-20

## Requirements

1.  **Persistence:** Client credentials must be stored in RocksDB to survive server restarts.
2.  **Encryption at Rest:** All client data (including hashed passwords and metadata) must be encrypted using AES-256-GCM before being stored in RocksDB.
3.  **Key Management:** The encryption master key must be provided via an environment variable (`BOOMERANG_MASTER_KEY`) or system property.
4.  **Interface Abstraction:** Define a `ClientStore` interface to decouple the storage logic from `AuthService`.
5.  **Integration:** Refactor `AuthService` to use `ClientStore` instead of an in-memory map.
6.  **Initial Admin:** Ensure a default admin client can be provisioned or loaded from configuration.

## Sub-tasks

- [x] **Define `ClientStore` Interface:** Create the interface with CRUD operations for clients.
- [x] **Implement `EncryptionService`:** Create a utility for AES-256-GCM encryption and decryption.
- [x] **Implement `RocksDBClientStore`:**
    - [x] Initialize a new RocksDB Column Family for clients.
    - [x] Implement CRUD operations with encryption/decryption.
    - [x] Handle serialization/deserialization of `Client` objects.
- [x] **Update `ServerConfig`:** Add methods to retrieve the master key and any new storage paths.
- [x] **Refactor `AuthService`:**
    - [x] Inject `ClientStore`.
    - [x] Migrate in-memory logic to use `ClientStore`.
    - [x] Ensure admin registration logic works with the new store.
- [x] **Verification:**
    - [x] Unit tests for `EncryptionService`.
    - [x] Integration tests for `RocksDBClientStore`.
    - [x] Update `AuthServiceTest` to use the persistent store.
    - [x] Mutation testing verification.

## Technical Details

- **Algorithm:** AES-256-GCM
- **Key Source:** `BOOMERANG_MASTER_KEY` environment variable.
- **Storage:** RocksDB Column Family `clients`.
- **Serialization:** Java Serialization (for now, as `Client` is a record) or a simple byte-buffer based approach if preferred. Given the current structure, a simple custom serialization or Jackson might be cleaner. Let's stick to a simple byte-based approach for the `Client` record.

## Constraints
- Follow project standards for Javadoc and code style.
- Maintain at least 80% code coverage and mutation score.
