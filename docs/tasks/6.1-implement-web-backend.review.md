# Task 6.1 Review: Implement Web Backend (Spring Boot 4)

## Review Information
- **Task:** [Task 6.1: Implement Web Backend (Spring Boot 4)](6.1-implement-web-backend.md)
- **Commit:** `5c70741f33445e0723f9f4c2807d181fc9e341ba`
- **Reviewer:** Gemini CLI
- **Date:** 2026-02-24

## 1. Goal & Requirements Alignment
The implementation largely satisfies the goals of Task 6.1, scaffolding a Spring Boot 4 module and integrating it with `boomerang-client-java`.

- **Spring Boot 4:** Successfully used Spring Boot `4.0.0`.
- **Core Integration:** Correct use of `boomerang-client-java`.
- **Authentication:** `/api/login` implemented and session-based auth correctly handled via headers.
- **Task Management API:** Implemented, but with path deviations (see below).
- **Security:** Spring Security configured, but very permissive (`permitAll()`).
- **Integration Testing:** Excellent use of Testcontainers and Docker to verify functionality.

## 2. Technical Standards & Guidelines (GUIDELINES.md)
- **Java 21:** Adhered to.
- **Gradle (Kotlin DSL):** Adhered to.
- **Code Formatting:** Adhered to (implied by `spotlessApply` usage in commit message).
- **Javadoc Standards:** **CRITICAL VIOLATION.** Most public classes, methods, and constants lack Javadoc. `GUIDELINES.md` requires Javadoc for all public/protected elements.
- **Guard Clauses:** Generally followed, though some methods could be further simplified.
- **Mutation Testing:** Skipped as per task-specific exclusion (permissible).

## 3. Findings & Observations

### 3.1. Path Deviations (Accepted)
The task requirements explicitly requested:
- `POST /api/tasks/register`
- `POST /api/tasks/cancel`

The current implementation uses:
- `POST /api/tasks` (for registration)
- `DELETE /api/tasks/{id}` (for cancellation)

While these deviate from the initial task description, they follow standard RESTful conventions and are accepted as idiomatic for this project.

### 3.2. Error Handling (Action Required)
The controllers (e.g., `TaskController`) return `401 Unauthorized` for *any* exception caught during service calls.
```java
    try {
      TaskResponse response = taskService.register(sessionId, taskDto);
      return ResponseEntity.ok(response);
    } catch (Exception e) {
      return ResponseEntity.status(401).build();
    }
```
This is misleading. If a `BoomerangException` is thrown due to a server error or an invalid request, a `400 Bad Request` or `500 Internal Server Error` should be returned. `401` should be reserved for authentication failures (e.g., invalid or expired session).

### 3.3. Security Configuration (Observation)
`SecurityConfig.java` disables CSRF and uses `permitAll()` for all requests. 
```java
    http.csrf(AbstractHttpConfigurer::disable)
        .cors(cors -> cors.configurationSource(corsConfigurationSource()))
        .authorizeHttpRequests(auth -> auth.anyRequest().permitAll());
```
While session verification is manually performed in the controllers, this bypasses Spring Security's powerful authorization features. For a production-ready system, it's recommended to integrate session validation into the Spring Security filter chain.

### 3.4. Docker Optimization (Positive)
The optimization of `boomerang-core/Dockerfile` and its use in integration tests is a strong addition that improves the development lifecycle.

## 4. Recommendations
1.  **Add Javadoc:** Add Javadoc to all public classes and methods in the `boomerang-web-backend` module as per `GUIDELINES.md`.
2.  **Refine Error Handling:** Implement more granular error handling in controllers to distinguish between authentication errors, client errors, and server errors.
3.  **Security Hardening:** Consider using a custom `OncePerRequestFilter` to handle session validation within the Spring Security context rather than repeating it in every controller method.

## 5. Review Conclusion
**Status:** ⚠️ **Requires Revision**

The implementation is functionally sound and the integration tests are robust. However, the lack of Javadoc is a major violation of project standards, and the path deviations and brute-force error handling should be addressed before final approval.

---
**Approved by Human Operator:** [ ] YES / [ ] NO
